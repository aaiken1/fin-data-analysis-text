
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Using APIs for Data Imports &#8212; Data Analysis in Finance</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Essential portfolio math" href="8_port_math.html" />
    <link rel="prev" title="6. Financial time series" href="6_financial_ts.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/cat.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Analysis in Finance</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_finpyth.html">
   1. Why Python and finance?
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="2_1_intro.html">
   2. Python set-up
   <a id="python_set-up">
   </a>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="2_2_install.html">
     2.2. Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_3_jupyter.html">
     2.3. Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_4_googlecolab.html">
     2.4. Google Colab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_5_vscode.html">
     2.5. VS Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_6_markdown.html">
     2.6. Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_7_packages.html">
     2.7. Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_8_style.html">
     2.8. Code style, PEP8, and linting
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="3_1_intro.html">
   3. CompSci 101: Types, control, and numpy arrays
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="3_2_comp101.html">
     3.1. The Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3_3_numpy.html">
     3.2. Numpy and arrays
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="4_intro.html">
   4. Pandas and data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="4_0_dataframes.html">
     4.1. Data importing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_1_pandas.html">
     4.2. pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_2_cleaning_data.html">
     4.3. Cleaning our data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_3_eda.html">
     4.4. Exploratory data analysis (EDA)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_4_merge_shape.html">
     4.5. Merging and reshaping data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_5_sql.html">
     4.6. Using SQL in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_6_polar.html">
     4.7. polars: A fast, fancy pandas alternative
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="5_intro.html">
   5. Data visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="5_0_matplotlib.html">
     5.1. matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_1_plotly.html">
     5.2. plotly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_2_seaborn.html">
     5.3. seaborn
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6_financial_ts.html">
   6. Financial time series
   <a id="financial-time-series">
   </a>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. Using APIs for Data Imports
   <a id="btc-sim">
   </a>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8_port_math.html">
   8. Essential portfolio math
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9_portfolio_opt.html">
   9. Portfolio optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_factor_models.html">
   10. Factor models
   <a id="factor_models">
   </a>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_regression_topics.html">
   11. Regression topics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_risk_mang.html">
   12. Risk management
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_monte_carlo.html">
   13. Monte Carlo and portfolios
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_options.html">
   14. Option basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_logit_credit.html">
   15. Logit models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_trading_bt.html">
   16. Trading Strategies and the BT Package
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Labs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lab_intro.html">
   Our labs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab01.html">
   Lab 01
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab02.html">
   Lab 02
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab03.html">
   Lab 03
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab04.html">
   Lab 04
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab05.html">
   Lab 05
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab06.html">
   Lab 06
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exams
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="exam_intro.html">
   Our Exams
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exam01.html">
   Midterm Exam
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/chapters/7_nasdaq_api.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapters/7_nasdaq_api.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pandas-datareader">
   7.1. Using pandas-datareader
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-gpt-to-write-a-function-for-you">
   7.2. Using GPT to Write a Function For You
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-details-using-apis">
   7.3. Data Details - Using APIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nasdaq-api-another-example">
     7.3.1. NASDAQ API - Another Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-rapid-api">
     7.3.2. Using Rapid API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-on-kaggle">
     7.3.3. Data on Kaggle
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using APIs for Data Imports <a id='btc-sim'></a></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pandas-datareader">
   7.1. Using pandas-datareader
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-gpt-to-write-a-function-for-you">
   7.2. Using GPT to Write a Function For You
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-details-using-apis">
   7.3. Data Details - Using APIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nasdaq-api-another-example">
     7.3.1. NASDAQ API - Another Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-rapid-api">
     7.3.2. Using Rapid API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-on-kaggle">
     7.3.3. Data on Kaggle
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="using-apis-for-data-imports-a-id-btc-sim-a">
<h1><span class="section-number">7. </span>Using APIs for Data Imports <a id='btc-sim'></a><a class="headerlink" href="#using-apis-for-data-imports-a-id-btc-sim-a" title="Permalink to this headline">#</a></h1>
<p>This chapter starts by using <a class="reference external" href="https://data.nasdaq.com/tools/api">NASDAQ Data Link</a> to download some BTC price and return data. We’ll also see our first set of <strong>simulations</strong>. I’ll then show you how to use <a class="reference external" href="https://pandas-datareader.readthedocs.io/en/latest/">Pandas Data Reader</a>.</p>
<p>This is also our first time using an <strong>API</strong>. Their API, or Application Programming Interface, let’s us talk to a remote data storage system and pull in what we need. APIs are more general, though, and are used whenever you need one application to talk to another.</p>
<p>We’ll use the <a class="reference external" href="https://data.nasdaq.com/tools/api">NASDAQ Data Link</a>. They also have <a class="reference external" href="https://data.nasdaq.com/tools/python">Python specific instructions</a>.</p>
<p>You can read about the install <a class="reference external" href="https://pypi.org/project/Nasdaq-Data-Link/">on their package page</a>.</p>
<p>We can again use <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install packages via the command line or in your Jupyter notebook.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">nasdaq</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">link</span>
</pre></div>
</div>
<p>To install a package directly in your notebook (e.g. in Google Colabs), use the <code class="docutils literal notranslate"><span class="pre">!</span> <span class="pre">pip</span></code> convention.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>! pip install nasdaq-data-link
</pre></div>
</div>
<p>When you sign-up for NASDAQ Data Link, you’ll get an API Key. You will need to add this key to the set-up to access the NASDAQ data using Quandl.</p>
<p>I have saved my key locally and am bringing it in with <code class="docutils literal notranslate"><span class="pre">quandl.read_key</span></code>, so that it isn’t publicly available. You don’t need that bit of code.</p>
<p>You can also install <code class="docutils literal notranslate"><span class="pre">pandas-datareader</span></code> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pandas</span><span class="o">-</span><span class="n">datareader</span>
</pre></div>
</div>
<p>Again, add the <code class="docutils literal notranslate"><span class="pre">!</span> <span class="pre">pip</span></code> if you’re in Google Colab.</p>
<p>Finally, for a large set of APIs for access data, check out <a class="reference external" href="https://rapidapi.com/hub">Rapid API</a>. Some are free, others you have to pay for. You’ll need to get an access API key for each one. <strong>This is a great way to get data for projects!</strong>. More on this at the end of these notes.</p>
<p>Let’s do our usual sort of set-up code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set-up</span>

<span class="kn">import</span> <span class="nn">nasdaqdatalink</span> <span class="c1"># You could also do something like: import nasdaqdatalink as ndl</span>
<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">pdr</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span> 

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># nasdaqdatalink.ApiConfig.api_key = &#39;YOUR_KEY_HERE&#39;</span>

<span class="n">nasdaqdatalink</span><span class="o">.</span><span class="n">read_key</span><span class="p">()</span>

<span class="c1">#nasdaqdatalink.read_key(filepath=&quot;/data/.corporatenasdaqdatalinkapikey&quot;)</span>
<span class="c1">#print(nasdaqdatalink.ApiConfig.api_key)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp</span> <span class="o">=</span> <span class="n">nasdaqdatalink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FRED/GDP&#39;</span><span class="p">)</span>
<span class="n">gdp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1947-01-01</th>
      <td>243.164</td>
    </tr>
    <tr>
      <th>1947-04-01</th>
      <td>245.968</td>
    </tr>
    <tr>
      <th>1947-07-01</th>
      <td>249.585</td>
    </tr>
    <tr>
      <th>1947-10-01</th>
      <td>259.745</td>
    </tr>
    <tr>
      <th>1948-01-01</th>
      <td>265.742</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-10-01</th>
      <td>21477.597</td>
    </tr>
    <tr>
      <th>2021-01-01</th>
      <td>22038.226</td>
    </tr>
    <tr>
      <th>2021-04-01</th>
      <td>22740.959</td>
    </tr>
    <tr>
      <th>2021-07-01</th>
      <td>23202.344</td>
    </tr>
    <tr>
      <th>2021-10-01</th>
      <td>23992.355</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 1 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">btc</span> <span class="o">=</span> <span class="n">nasdaqdatalink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BCHAIN/MKPRU&#39;</span><span class="p">)</span>
<span class="n">btc</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-04-11</th>
      <td>29656.24</td>
    </tr>
    <tr>
      <th>2023-04-12</th>
      <td>30234.98</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>29899.24</td>
    </tr>
    <tr>
      <th>2023-04-14</th>
      <td>30407.60</td>
    </tr>
    <tr>
      <th>2023-04-15</th>
      <td>30486.05</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">btc</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">btc</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">:,[</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">]]</span>
<span class="n">btc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../_images/7_nasdaq_api_6_1.png" src="../_images/7_nasdaq_api_6_1.png" />
</div>
</div>
<p>Well, that’s not a very good graph. The returns and price levels are in different units. Let’s use an <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">print</span></code> to show and format the average BTC return.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average return: </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average return: 0.23%
</pre></div>
</div>
</div>
</div>
<p>Let’s make a cumulative return chart and daily return chart. We can then stack these on top of each other. I’ll use the <code class="docutils literal notranslate"><span class="pre">.sub(1)</span></code> method to subtract 1 from the cumulative product. You see this a lot in the DataCamps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">btc</span><span class="p">[</span><span class="s1">&#39;ret_g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># gross return</span>
<span class="n">btc</span><span class="p">[</span><span class="s1">&#39;ret_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">ret_g</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># cummulative return</span>
<span class="n">btc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
      <th>ret</th>
      <th>ret_g</th>
      <th>ret_c</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01</th>
      <td>316.15</td>
      <td>0.001425</td>
      <td>1.001425</td>
      <td>0.001425</td>
    </tr>
    <tr>
      <th>2015-01-02</th>
      <td>314.81</td>
      <td>-0.004238</td>
      <td>0.995762</td>
      <td>-0.002819</td>
    </tr>
    <tr>
      <th>2015-01-03</th>
      <td>270.93</td>
      <td>-0.139386</td>
      <td>0.860614</td>
      <td>-0.141812</td>
    </tr>
    <tr>
      <th>2015-01-04</th>
      <td>276.80</td>
      <td>0.021666</td>
      <td>1.021666</td>
      <td>-0.123218</td>
    </tr>
    <tr>
      <th>2015-01-05</th>
      <td>263.17</td>
      <td>-0.049241</td>
      <td>0.950759</td>
      <td>-0.166392</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2023-04-11</th>
      <td>29656.24</td>
      <td>0.046586</td>
      <td>1.046586</td>
      <td>92.938042</td>
    </tr>
    <tr>
      <th>2023-04-12</th>
      <td>30234.98</td>
      <td>0.019515</td>
      <td>1.019515</td>
      <td>94.771239</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>29899.24</td>
      <td>-0.011104</td>
      <td>0.988896</td>
      <td>93.707761</td>
    </tr>
    <tr>
      <th>2023-04-14</th>
      <td>30407.60</td>
      <td>0.017002</td>
      <td>1.017002</td>
      <td>95.318023</td>
    </tr>
    <tr>
      <th>2023-04-15</th>
      <td>30486.05</td>
      <td>0.002580</td>
      <td>1.002580</td>
      <td>95.566519</td>
    </tr>
  </tbody>
</table>
<p>3027 rows × 4 columns</p>
</div></div></div>
</div>
<p>We can now make a graph using the <strong>fig, axs</strong> method. This is good review! Again, notice that semi-colon at the end. This suppresses some annoying output in the Jupyter notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">btc</span><span class="o">.</span><span class="n">ret_c</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BTC Cumulative Return&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BTC Daily Return&#39;</span><span class="p">)</span>
            
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BTC Cumulative Returns&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BTC Daily Returns&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7_nasdaq_api_12_0.png" src="../_images/7_nasdaq_api_12_0.png" />
</div>
</div>
<p>I can make the same graph using the <code class="docutils literal notranslate"><span class="pre">.add_subplot()</span></code> syntax. The method above gives you some more flexibility, since you can give both plots the same x-axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">btc</span><span class="o">.</span><span class="n">ret_c</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BTC Cumulative Return&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BTC Daily Return&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BTC Cumulative Returns&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BTC Daily Returns&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7_nasdaq_api_14_0.png" src="../_images/7_nasdaq_api_14_0.png" />
</div>
</div>
<p>Let’s put together some ideas, write a function, and run a simulation. We’ll use something called <strong>geometric brownian motion</strong> (GBM). What is GBM? It is a particular <a class="reference external" href="https://arxiv.org/pdf/1504.05309.pdf">stochastic differential equation</a>. But, what’s important for us is the idea, which is fairly simple. Here’s the formula:</p>
<div class="amsmath math notranslate nohighlight" id="equation-07931236-9c55-4ad4-96de-44daa38d8f1e">
<span class="eqno">(7.1)<a class="headerlink" href="#equation-07931236-9c55-4ad4-96de-44daa38d8f1e" title="Permalink to this equation">#</a></span>\[\begin{align}
dS = \mu S dt + \sigma S dW_t
\end{align}\]</div>
<p>This says that the change in the stock price has two components - a <strong>drift</strong>, or average increase over time, and a <strong>shock</strong> that it is random at each point in time. The shock is scaled by the standard deviation of returns that you use. So, larger standard deviation, the bigger the shocks can be. This is basically the simplest way that you can model an asset price.</p>
<p>The shocks are what make the price wiggle around around, or else it would just go up over time, based on the drift value that we use.</p>
<p>And, I’ll stress - we aren’t predicting here, so to speak. We are trying to capture some basic reality about how an asset moves and then seeing what is possible in the future. We aren’t making a statement about whether we think an asset is overvalued or undervalued, will go up or down, etc.</p>
<p>You can solve this equation to get the value of the asset at any point in time t. You just need to know the total of all of the shocks at time t.</p>
<div class="amsmath math notranslate nohighlight" id="equation-588c6305-2ea6-4cf9-9d5d-fb1a3eba2ce6">
<span class="eqno">(7.2)<a class="headerlink" href="#equation-588c6305-2ea6-4cf9-9d5d-fb1a3eba2ce6" title="Permalink to this equation">#</a></span>\[\begin{align}
S(t) = S(0) \exp \left(\left(\mu - \frac{1}{2}\sigma^2\right)t + \sigma W(t)\right)
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># How long is our simulation? Let&#39;s do 31 days (0 to 30 the way Python counts)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># number of time points in the prediction time horizon, making this the same as T means that we will simulate daily returns </span>
<span class="n">S_0</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">Value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># initial BTC price</span>
<span class="n">N_SIM</span> <span class="o">=</span> <span class="mi">100</span>      <span class="c1"># How many simulations to run?</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">btc</span><span class="o">.</span><span class="n">ret</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This is the basic syntax for writing a function in Python. We saw this earlier, back when doing “Comp 101”. Remember, in Python, <strong>indentation matters</strong>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulate_gbm</span><span class="p">(</span><span class="n">s_0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">N</span> <span class="c1"># One day</span>
    <span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span> 
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_sims</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1"># The random part</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dW</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="p">(</span><span class="n">n_sims</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">S_t</span> <span class="o">=</span> <span class="n">s_0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">mu</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">time_steps</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">time_steps</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
    <span class="n">S_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">S_t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S_t</span>
</pre></div>
</div>
</div>
</div>
<p>Nothing happens when we define a function. We’ve just created something called <code class="docutils literal notranslate"><span class="pre">simulate_gbm</span></code> that we can now use just like any other Python function.</p>
<p>We can look at each piece of the function code, with some numbers hard-coded, to get a sense of what’s going on. This gets tricky - keep track of the dimensions. I think that’s the hardest part. How many numbers are we creating in each array? What do they mean?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates 100 rows of 30 random numbers from the standard normal distribution.</span>
<span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

<span class="c1"># cumulative sum along each row</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dW</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

<span class="c1"># Array with numbers from 1 to 30</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># Expands that to be 100 rows of numbers from 1 to 30. This is going to be the t in the formula above. So, for the price on the 30th day, we have t=30.</span>
<span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

<span class="c1"># This is the formula from above to find the value of the asset any any point in time t. np.exp is the natural number e. W is the cumulative sum of all of our random shocks.</span>
<span class="n">S_t</span> <span class="o">=</span> <span class="n">S_0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">mu</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">time_steps</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">time_steps</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>

<span class="c1"># This inserts the initial price at the start of each row.</span>
<span class="n">S_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">S_t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">S_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can look at these individually, too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.63366296, -1.60859415,  0.28056729, ..., -0.12315379,
        -0.18762552, -1.11441786],
       [ 0.4103219 , -0.43883911, -0.53788909, ...,  2.4796018 ,
         0.3388995 , -0.01737322],
       [ 0.36157372,  2.07565958,  0.72118386, ..., -1.71325332,
        -0.75371094,  0.9241138 ],
       ...,
       [-0.48895368, -1.46002063, -0.00687169, ...,  0.55193853,
         0.99716908,  0.95090557],
       [-0.19337377, -0.52634845, -0.11492505, ..., -0.08055585,
        -0.95217081, -0.49010065],
       [-0.15340396,  0.85981032, -0.18784381, ..., -0.27167434,
        -0.10028919,  0.82940716]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_steps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.,  2.,  3., ..., 28., 29., 30.],
       [ 1.,  2.,  3., ..., 28., 29., 30.],
       [ 1.,  2.,  3., ..., 28., 29., 30.],
       ...,
       [ 1.,  2.,  3., ..., 28., 29., 30.],
       [ 1.,  2.,  3., ..., 28., 29., 30.],
       [ 1.,  2.,  3., ..., 28., 29., 30.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">time_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">time_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 30)
</pre></div>
</div>
</div>
</div>
<p>I do this kind of step-by-step break down <strong>all of the time</strong>. It’s the only way I can understand what’s going on.</p>
<p>We can then use our function. This returns an <code class="docutils literal notranslate"><span class="pre">narray</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbm_simulations</span> <span class="o">=</span> <span class="n">simulate_gbm</span><span class="p">(</span><span class="n">S_0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">N_SIM</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And, we can plot all of the simulations. I’m going to use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to plot, save to <code class="docutils literal notranslate"><span class="pre">ax</span></code>, and the style the <code class="docutils literal notranslate"><span class="pre">ax</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gbm_simulations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">gbm_simulations</span><span class="p">))</span>

<span class="c1"># plotting</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">gbm_simulations_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BTC Simulations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7_nasdaq_api_29_0.png" src="../_images/7_nasdaq_api_29_0.png" />
</div>
</div>
<p>The y-axis has a very wide range, since some extreme values are possible, given this simulation.</p>
<section id="using-pandas-datareader">
<h2><span class="section-number">7.1. </span>Using pandas-datareader<a class="headerlink" href="#using-pandas-datareader" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://pydata.github.io/pandas-datareader/">pandas data-reader</a> API lets us access additional data sources, such as <a class="reference external" href="https://fred.stlouisfed.org">FRED</a>.</p>
<p>There are also API that let you access the same data. For example, Yahoo! Finance has several, like <a class="reference external" href="https://pypi.org/project/yfinance/">yfinance</a>. I think that the Yahoo! Finance access for <code class="docutils literal notranslate"><span class="pre">pandas-datareader</span></code> was <a class="reference external" href="https://stackoverflow.com/questions/74834834/pdr-datareader-typeerror-string-indices-must-be-integers">broken in a recent update</a>.</p>
<p>Lots of developers have written APIs to access different data sources.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Different data sources might require API keys. Sometimes you have to pay. Always read the documentation.</p>
</div>
<p>Here’s another FRED example, but using <code class="docutils literal notranslate"><span class="pre">pandas-datareader</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>

<span class="n">gdp</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;GDP&#39;</span><span class="p">,</span> <span class="s1">&#39;fred&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">gdp</span><span class="o">.</span><span class="n">head</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;bound method NDFrame.head of                   GDP
DATE                 
2010-01-01  14764.611
2010-04-01  14980.193
2010-07-01  15141.605
2010-10-01  15309.471
2011-01-01  15351.444
2011-04-01  15557.535
2011-07-01  15647.681
2011-10-01  15842.267
2012-01-01  16068.824
2012-04-01  16207.130
2012-07-01  16319.540
2012-10-01  16420.386
2013-01-01  16629.050&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-gpt-to-write-a-function-for-you">
<h2><span class="section-number">7.2. </span>Using GPT to Write a Function For You<a class="headerlink" href="#using-gpt-to-write-a-function-for-you" title="Permalink to this headline">#</a></h2>
<p>I gave GPT4 the following prompt:</p>
<blockquote>
<div><p>Write a function in Python that simulates geometric brownian motion for any number of assets. Create the appropriate inputs as arrays. The inputs should be the number of assets, the mean for each asset, the standard deviation for each asset, the number of periods, the initial value of each asset, and the number of simulations. The output should be an array that contains all of the simulations for each asset. These are uncorrelated assets, so don’t worry about covariance.</p>
</div></blockquote>
<p>Here’s the code that it gave me:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">geometric_brownian_motion</span><span class="p">(</span><span class="n">num_assets</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">std_devs</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_assets</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">std_devs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_assets</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_assets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of means, std_devs, and initial_values should be equal to the number of assets&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize an array to store the simulations</span>
    <span class="n">simulations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_simulations</span><span class="p">,</span> <span class="n">num_periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_assets</span><span class="p">))</span>

    <span class="c1"># Set the initial values for each simulation</span>
    <span class="n">simulations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">initial_values</span>

    <span class="c1"># Time step</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Loop through each simulation</span>
    <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>
        <span class="c1"># Loop through each time period</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Loop through each asset</span>
            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">):</span>
                <span class="c1"># Generate a random normal value (using mean=0 and std_dev=1) for the brownian motion</span>
                <span class="n">random_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Calculate the change in asset value using geometric brownian motion</span>
                <span class="n">change</span> <span class="o">=</span> <span class="n">means</span><span class="p">[</span><span class="n">asset</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">std_devs</span><span class="p">[</span><span class="n">asset</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">random_normal</span>

                <span class="c1"># Update the asset value</span>
                <span class="n">simulations</span><span class="p">[</span><span class="n">sim</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">asset</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulations</span><span class="p">[</span><span class="n">sim</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">asset</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simulations</span>

<span class="c1"># Example usage</span>
<span class="n">num_assets</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">])</span>
<span class="n">std_devs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">])</span>
<span class="n">num_periods</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">initial_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">])</span>
<span class="n">num_simulations</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">simulations</span> <span class="o">=</span> <span class="n">geometric_brownian_motion</span><span class="p">(</span><span class="n">num_assets</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">std_devs</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">simulations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [9.98038053e+01 1.30049858e+02 1.91623666e+02]
  [1.27217424e+02 1.46610670e+02 2.46422707e+02]
  ...
  [1.08408726e+04 4.67179041e+04 9.42020664e+04]
  [1.30555478e+04 4.91839032e+04 1.14420043e+05]
  [1.30613524e+04 6.27894176e+04 1.14971099e+05]]

 [[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [1.11341419e+02 9.16476920e+01 1.80918617e+02]
  [1.18428296e+02 9.72113832e+01 1.68863462e+02]
  ...
  [6.19793779e+03 6.58420011e+03 1.38231869e+05]
  [6.30011044e+03 6.57265842e+03 1.81891299e+05]
  [6.40461861e+03 7.04326840e+03 1.31364904e+05]]

 [[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [1.01581129e+02 1.24768173e+02 1.65656447e+02]
  [1.19162006e+02 1.35478653e+02 1.68271557e+02]
  ...
  [1.26206477e+04 5.06580156e+04 4.92116571e+04]
  [1.19597720e+04 6.13015647e+04 3.74250494e+04]
  [1.24259234e+04 6.74056118e+04 3.61256098e+04]]

 ...

 [[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [1.28775899e+02 1.18242370e+02 1.22013984e+02]
  [1.25190027e+02 1.10121377e+02 1.27394167e+02]
  ...
  [8.45754955e+03 2.96299249e+04 4.14623230e+05]
  [1.01802162e+04 3.57465367e+04 6.92738164e+05]
  [1.02603771e+04 3.37069682e+04 8.54055671e+05]]

 [[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [1.06748310e+02 1.14295222e+02 1.46975243e+02]
  [1.21200581e+02 1.65725596e+02 1.91573891e+02]
  ...
  [4.43187466e+03 1.60702544e+04 1.28711284e+05]
  [3.48111875e+03 1.83893175e+04 1.21587460e+05]
  [4.15560464e+03 2.07356249e+04 1.45696763e+05]]

 [[1.00000000e+02 1.20000000e+02 1.40000000e+02]
  [9.58427578e+01 1.26479442e+02 1.43024241e+02]
  [1.08678026e+02 1.18657795e+02 1.67385102e+02]
  ...
  [1.24084992e+04 3.03426581e+04 1.50711914e+04]
  [1.31276163e+04 3.96658542e+04 1.80678432e+04]
  [1.30299091e+04 4.34964500e+04 1.61303930e+04]]]
</pre></div>
</div>
</div>
</div>
<p>Here’s the GPT explanation of the code.</p>
<blockquote>
<div><p>This function accepts the following inputs:</p>
</div></blockquote>
<blockquote>
<div><p>num_assets: the number of assets <br />
means: a NumPy array containing the mean return for each asset <br />
std_devs: a NumPy array containing the standard deviation of return for each asset <br />
num_periods: the number of time periods <br />
initial_values: a NumPy array containing the initial value for each asset <br />
num_simulations: the number of simulations to run</p>
</div></blockquote>
<blockquote>
<div><p>The function returns a 3D NumPy array containing the simulations for each asset, with dimensions (num_simulations, num_periods + 1, num_assets).</p>
</div></blockquote>
<p>Let’s look a bit more at the output. I’ll get its <code class="docutils literal notranslate"><span class="pre">.shape</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">simulations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulations</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 101, 3)
</pre></div>
</div>
</div>
</div>
<p>The output is a <strong>three-dimensional array</strong>. We can pull out all of the simulations for one asset, as well as a single simulation for one asset. Or anything else.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All simulations for the first asset.</span>
<span class="n">simulations</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  100.        ,    99.80380531,   127.21742355, ...,
        10840.87259695, 13055.54784496, 13061.35241467],
       [  100.        ,   111.34141913,   118.42829589, ...,
         6197.93779121,  6300.11044313,  6404.61860884],
       [  100.        ,   101.58112873,   119.16200582, ...,
        12620.64774408, 11959.77198089, 12425.92341166],
       ...,
       [  100.        ,   128.77589948,   125.19002697, ...,
         8457.54955499, 10180.21624659, 10260.37713214],
       [  100.        ,   106.74830982,   121.20058115, ...,
         4431.87466366,  3481.11875124,  4155.60464226],
       [  100.        ,    95.84275778,   108.67802618, ...,
        12408.49918534, 13127.61628823, 13029.90913145]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All simulations for the second asset.</span>
<span class="n">simulations</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  120.        ,   130.04985811,   146.61066954, ...,
        46717.90413308, 49183.9031992 , 62789.41759685],
       [  120.        ,    91.64769196,    97.21138323, ...,
         6584.20011226,  6572.65842042,  7043.268396  ],
       [  120.        ,   124.7681725 ,   135.478653  , ...,
        50658.01558909, 61301.56470781, 67405.61177037],
       ...,
       [  120.        ,   118.24236967,   110.12137665, ...,
        29629.92494801, 35746.5366535 , 33706.9682058 ],
       [  120.        ,   114.2952218 ,   165.72559583, ...,
        16070.25440735, 18389.31752158, 20735.62490854],
       [  120.        ,   126.47944233,   118.65779487, ...,
        30342.65811853, 39665.85422029, 43496.44996805]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First simulation for the first asset</span>

<span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  100.        ,    99.80380531,   127.21742355,   128.30033879,
         152.15650654,   146.99111497,   135.89267692,   139.00473603,
         134.52652276,   148.26959279,   169.81710222,   158.75960654,
         141.56357706,   119.49852738,   117.15537281,   126.96315381,
         125.94105429,   122.36276394,   110.12269938,   100.98678436,
         101.42596543,    89.26728706,   102.38423524,    99.47739411,
         113.657107  ,   113.57301136,   125.23064967,   140.21101762,
         189.2683582 ,   214.97517542,   237.25959972,   284.2497211 ,
         302.29807395,   326.1899012 ,   311.2853353 ,   344.50608406,
         367.178519  ,   374.38783728,   431.64687191,   428.614285  ,
         590.24862429,   592.81290753,   549.33088663,   710.86236456,
         758.76993038,   737.90378883,   741.36839224,   639.98089024,
         781.33471864,   808.65238996,  1011.74531829,   996.56512974,
        1075.82050489,  1046.46405882,  1078.64745409,  1140.11076216,
        1408.9869508 ,  1367.34622199,  1363.82146997,  1435.05060276,
        1505.18412898,  1558.7219567 ,  1614.68330666,  1879.0880815 ,
        1838.26410141,  2251.58687262,  2412.71362331,  2541.47923005,
        2343.05451325,  2247.92959104,  2121.75301216,  2556.98756646,
        2262.5263025 ,  1891.55968425,  2227.19941387,  2892.6743114 ,
        2866.3367328 ,  2932.42504261,  4145.43752133,  3792.89967882,
        3947.0671017 ,  4394.98122449,  5340.25702864,  6287.10552686,
        6002.75322415,  6679.40957494,  6929.08815557,  7881.60326198,
        8048.48827625,  9596.82507131, 12132.99597185, 10683.33778009,
       11696.11701748, 12877.26618171, 12300.47393991,  9511.84301429,
        9955.04644916, 10857.34475874, 10840.87259695, 13055.54784496,
       13061.35241467])
</pre></div>
</div>
</div>
</div>
<p>Compare this code to the one we used above. What’s different? What stands out to you? What assumptions did it make? What’s up with these numbers?</p>
<p>GPT is quite good at creating code that has been done in a lot of places. It has trained on millions of online tutorials and examples. However, you still want to follow the logic and check for errors. <strong>There will be errors.</strong></p>
<p><strong>You can have a “dialog” with GPT.</strong> Look at the code. Is it what you want? You can ask it to change it for you.</p>
<p><strong>What does that leave for us to do?</strong> Use GPT to start sketching your code, do to certain tasks. Figure out what you need. Figure out the questions that you’re trying answer. What’s the problem that you’re trying to solve? Who are you solving it for? What will the answer look like? What will it tell you?</p>
<p>Using tools like GPT, Github Co-Pilot, etc. is like having a team of junior programmers working for you. They can make the job easier, but it is still up to you to know what’s an interesting question in the first place. <strong>You still need to use your domain expertise and creativity to come up with solutions to problems that aren’t in an online Python tutorials.</strong></p>
</section>
<section id="data-details-using-apis">
<h2><span class="section-number">7.3. </span>Data Details - Using APIs<a class="headerlink" href="#data-details-using-apis" title="Permalink to this headline">#</a></h2>
<p>This notes above use the <a class="reference external" href="https://www.nasdaq.com/nasdaq-data-link">NASDAQ Datalink API</a> to pull some BTC data. Now, I’ll discuss using this API more generally, as well as using <a class="reference external" href="https://rapidapi.com/hub">Rapid API</a>, another website with a variety of data options. I’ll also show you an API from Github.</p>
<p>As mentioned above, APIs are ways for one program or piece of software to talk to another. In our case, we’re using them to get data. That data might come in as a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame, ready to use. Other times, it might come in as something called a <a class="reference external" href="https://realpython.com/python-json/">JSON</a> file. We’ll have to do a bit more work with this common data structure.</p>
<section id="nasdaq-api-another-example">
<h3><span class="section-number">7.3.1. </span>NASDAQ API - Another Example<a class="headerlink" href="#nasdaq-api-another-example" title="Permalink to this headline">#</a></h3>
<p>Let’s look at the NASDAQ API one more time. Once you log in, you’ll see the home page below. Note the strip across the upper-left, that has API, Python, Excel, etc. You can use the NASDAQ API in a variety of settings. There’s a <strong>SEARCH FOR DATA</strong> box at the top.</p>
<figure class="align-center" id="nasdaq-home-png">
<img alt="../_images/07-nasdaq-home.png" src="../_images/07-nasdaq-home.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.1 </span><span class="caption-text">NASDAQ API homepage.</span><a class="headerlink" href="#nasdaq-home-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If you click <strong>EXPLORE</strong> next to the search box, you’re taken to a list of all of their data. Much of it is premium - you have to pay. However, you can filter for free data. There’s free data for house prices, gold and silver markets, IMF macro data, the Fed, etc. Much of this free data comes from Quandl, which was purchased by Nasdaq recently.</p>
<p>Quandl has been completely integrated by NASDAQ now, though you will see legacy instructions on the website that refer to its older API commands.</p>
<figure class="align-center" id="nasdaq-explore-png">
<img alt="../_images/07-nasdaq-explore.png" src="../_images/07-nasdaq-explore.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.2 </span><span class="caption-text">Exploring NASDAQ data options.</span><a class="headerlink" href="#nasdaq-explore-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Let’s look at the Zillow data, the first option presented when I look for free data. I’ve used them in labs and exams.</p>
<figure class="align-center" id="nasdaq-zillow-png">
<img alt="../_images/07-nasdaq-zillow.png" src="../_images/07-nasdaq-zillow.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3 </span><span class="caption-text">NASDAQ has an API for Zillow housing data.</span><a class="headerlink" href="#nasdaq-zillow-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Each the data APIs shows you samples of what you can access. So, we see an example table with data for a particular indicator and region. We also see a table that has a list of all of the indicators and what they measure. Finally, we see a table with all of the regions and what they represent.</p>
<p>This data structure makes it clear that we can download value data and then merge in ID and region descriptions if needed. But, how do we do that? See the tab in the upper-left, with <strong>DATA</strong> highlighted? You can click on <strong>DOCUMENTATION</strong> and <strong>USAGE</strong> to learn more. We’ll look at a quick example here.</p>
<p>Click <strong>USAGE</strong> and then the <strong>Python</strong> icon. You’ll seen an example that lets you filter by a single <em>indicator_id</em> and <em>region</em>. It has your API key and the <code class="docutils literal notranslate"><span class="pre">.get_table</span></code> method.</p>
<p>However, note the <code class="docutils literal notranslate"><span class="pre">quandl</span></code> stuff. They haven’t transitioned this code yet. You’ll need to do a <code class="docutils literal notranslate"><span class="pre">pip</span></code> install for quandl.</p>
<p>Also, we didn’t use <code class="docutils literal notranslate"><span class="pre">.get_table</span></code> above for BTC. The Zillow data is stored differently.</p>
<p>Make sure that you include your API key. You can input it directly, using the code that they provide. I’m using a different way to do the key that doesn’t require me to type my API key into this publicly available code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#! pip install quandl</span>

<span class="c1"># Bring in quandl for downloading data</span>
<span class="kn">import</span> <span class="nn">quandl</span>
<span class="c1"># quandl.ApiConfig.api_key = &#39;YOUR_KEY_HERE&#39;</span>
<span class="n">quandl</span><span class="o">.</span><span class="n">read_key</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You need that <code class="docutils literal notranslate"><span class="pre">paginate=True</span></code> in there in order to download all of the available data. Without it, it will only pull the first 10,000 rows. Using paginate extends the limit to 1,000,000 rows, or observations. Now, note that this could be a lot of data! You might need to download the data in chunks to get what you want.</p>
<p>Let’s try pulling in the <em>indicator_id</em> ZATT for all regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># zillow = quandl.get_table(&#39;ZILLOW/DATA&#39;, indicator_id = &#39;ZATT&#39;, paginate=True)</span>
</pre></div>
</div>
</div>
</div>
<p>I’ve commented out the code above, because I know it will exceed the download limit! So, we need to be more selective.</p>
<p>If you look on the NASDAQ Zillow documentation page, you’ll see the three tables that you can download, the variables inside of each, and what you’re allowed to filter on. You unfortunately can’t filter on date in the ZILLOW/DATA table. Other data sets, like FRED, do let you specify start and end dates. Every API is different.</p>
<p>You can find examples of how to filter and sub-select your data on the NASDAQ website: <a class="reference external" href="https://docs.data.nasdaq.com/docs/python-tables">https://docs.data.nasdaq.com/docs/python-tables</a></p>
<p>However, you can filter on <em>region_id</em>. Let’s pull the ZILLOW/REGIONS table to see what we can use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span> <span class="o">=</span> <span class="n">quandl</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s1">&#39;ZILLOW/REGIONS&#39;</span><span class="p">,</span> <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region_id</th>
      <th>region_type</th>
      <th>region</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>99999</td>
      <td>zip</td>
      <td>98847; WA; Wenatchee, WA; Chelan County; Pesha...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>99998</td>
      <td>zip</td>
      <td>98846; WA; Okanogan County; Pateros</td>
    </tr>
    <tr>
      <th>2</th>
      <td>99997</td>
      <td>zip</td>
      <td>98845; WA; Wenatchee; Douglas County; Palisades</td>
    </tr>
    <tr>
      <th>3</th>
      <td>99996</td>
      <td>zip</td>
      <td>98844; WA; Okanogan County; Oroville</td>
    </tr>
    <tr>
      <th>4</th>
      <td>99995</td>
      <td>zip</td>
      <td>98843; WA; Wenatchee, WA; Douglas County; Orondo</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>89300</th>
      <td>100000</td>
      <td>zip</td>
      <td>98848; WA; Moses Lake, WA; Grant County; Quincy</td>
    </tr>
    <tr>
      <th>89301</th>
      <td>10000</td>
      <td>city</td>
      <td>Bloomington; MD; Garrett County</td>
    </tr>
    <tr>
      <th>89302</th>
      <td>1000</td>
      <td>county</td>
      <td>Echols County; GA; Valdosta, GA</td>
    </tr>
    <tr>
      <th>89303</th>
      <td>100</td>
      <td>county</td>
      <td>Bibb County; AL; Birmingham-Hoover, AL</td>
    </tr>
    <tr>
      <th>89304</th>
      <td>10</td>
      <td>state</td>
      <td>Colorado</td>
    </tr>
  </tbody>
</table>
<p>89305 rows × 3 columns</p>
</div></div></div>
</div>
<p>What if we just want cities?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">regions</span><span class="o">.</span><span class="n">region_type</span> <span class="o">==</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span>
<span class="n">cities</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region_id</th>
      <th>region_type</th>
      <th>region</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>9999</td>
      <td>city</td>
      <td>Carrsville; VA; Virginia Beach-Norfolk-Newport...</td>
    </tr>
    <tr>
      <th>20</th>
      <td>9998</td>
      <td>city</td>
      <td>Birchleaf; VA; Dickenson County</td>
    </tr>
    <tr>
      <th>56</th>
      <td>9994</td>
      <td>city</td>
      <td>Wright; KS; Dodge City, KS; Ford County</td>
    </tr>
    <tr>
      <th>124</th>
      <td>9987</td>
      <td>city</td>
      <td>Weston; CT; Bridgeport-Stamford-Norwalk, CT; F...</td>
    </tr>
    <tr>
      <th>168</th>
      <td>9980</td>
      <td>city</td>
      <td>South Wilmington; IL; Chicago-Naperville-Elgin...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>89203</th>
      <td>10010</td>
      <td>city</td>
      <td>Atwood; KS; Rawlins County</td>
    </tr>
    <tr>
      <th>89224</th>
      <td>10008</td>
      <td>city</td>
      <td>Bound Brook; NJ; New York-Newark-Jersey City, ...</td>
    </tr>
    <tr>
      <th>89254</th>
      <td>10005</td>
      <td>city</td>
      <td>Chanute; KS; Neosho County</td>
    </tr>
    <tr>
      <th>89290</th>
      <td>10001</td>
      <td>city</td>
      <td>Blountsville; AL; Birmingham-Hoover, AL; Bloun...</td>
    </tr>
    <tr>
      <th>89301</th>
      <td>10000</td>
      <td>city</td>
      <td>Bloomington; MD; Garrett County</td>
    </tr>
  </tbody>
</table>
<p>28131 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 28131 entries, 10 to 89301
Data columns (total 3 columns):
 #   Column       Non-Null Count  Dtype 
---  ------       --------------  ----- 
 0   region_id    28131 non-null  object
 1   region_type  28131 non-null  object
 2   region       28131 non-null  object
dtypes: object(3)
memory usage: 879.1+ KB
</pre></div>
</div>
</div>
</div>
<p>I like to look and see what things are stored as, too. Remember, the <code class="docutils literal notranslate"><span class="pre">object</span></code> type is very generic.</p>
<p>There are 28,131 rows of cities! How about counties?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counties</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">regions</span><span class="o">.</span><span class="n">region_type</span> <span class="o">==</span> <span class="s1">&#39;county&#39;</span><span class="p">]</span>
<span class="n">counties</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region_id</th>
      <th>region_type</th>
      <th>region</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>94</th>
      <td>999</td>
      <td>county</td>
      <td>Durham County; NC; Durham-Chapel Hill, NC</td>
    </tr>
    <tr>
      <th>169</th>
      <td>998</td>
      <td>county</td>
      <td>Duplin County; NC</td>
    </tr>
    <tr>
      <th>246</th>
      <td>997</td>
      <td>county</td>
      <td>Dubois County; IN; Jasper, IN</td>
    </tr>
    <tr>
      <th>401</th>
      <td>995</td>
      <td>county</td>
      <td>Donley County; TX</td>
    </tr>
    <tr>
      <th>589</th>
      <td>993</td>
      <td>county</td>
      <td>Dimmit County; TX</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>89069</th>
      <td>1003</td>
      <td>county</td>
      <td>Elmore County; AL; Montgomery, AL</td>
    </tr>
    <tr>
      <th>89120</th>
      <td>1002</td>
      <td>county</td>
      <td>Elbert County; GA</td>
    </tr>
    <tr>
      <th>89204</th>
      <td>1001</td>
      <td>county</td>
      <td>Elbert County; CO; Denver-Aurora-Lakewood, CO</td>
    </tr>
    <tr>
      <th>89302</th>
      <td>1000</td>
      <td>county</td>
      <td>Echols County; GA; Valdosta, GA</td>
    </tr>
    <tr>
      <th>89303</th>
      <td>100</td>
      <td>county</td>
      <td>Bibb County; AL; Birmingham-Hoover, AL</td>
    </tr>
  </tbody>
</table>
<p>3097 rows × 3 columns</p>
</div></div></div>
</div>
<p>Can’t find the regions you want? You could export the whole thing to a CSV file and explore it in Excel. This will show up in whatever folder you currently have as your home in VS Code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counties</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;counties.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can also open up the <strong>Variables</strong> window at the top of VS Code (or the equivalent in Google Colab) and scroll through the file, looking for the <em>region_id</em> values that you want.</p>
<p>Finally, you can search the text in a column directly. Let’s find counties in NC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc_counties</span> <span class="o">=</span> <span class="n">counties</span><span class="p">[</span><span class="n">counties</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;; NC&quot;</span><span class="p">)]</span>
<span class="n">nc_counties</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region_id</th>
      <th>region_type</th>
      <th>region</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>94</th>
      <td>999</td>
      <td>county</td>
      <td>Durham County; NC; Durham-Chapel Hill, NC</td>
    </tr>
    <tr>
      <th>169</th>
      <td>998</td>
      <td>county</td>
      <td>Duplin County; NC</td>
    </tr>
    <tr>
      <th>2683</th>
      <td>962</td>
      <td>county</td>
      <td>Craven County; NC; New Bern, NC</td>
    </tr>
    <tr>
      <th>4637</th>
      <td>935</td>
      <td>county</td>
      <td>Chowan County; NC</td>
    </tr>
    <tr>
      <th>4972</th>
      <td>93</td>
      <td>county</td>
      <td>Ashe County; NC</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>87475</th>
      <td>1180</td>
      <td>county</td>
      <td>Martin County; NC</td>
    </tr>
    <tr>
      <th>87821</th>
      <td>1147</td>
      <td>county</td>
      <td>Lenoir County; NC; Kinston, NC</td>
    </tr>
    <tr>
      <th>88578</th>
      <td>1059</td>
      <td>county</td>
      <td>Greene County; NC</td>
    </tr>
    <tr>
      <th>88670</th>
      <td>1049</td>
      <td>county</td>
      <td>Graham County; NC</td>
    </tr>
    <tr>
      <th>88823</th>
      <td>1032</td>
      <td>county</td>
      <td>Gaston County; NC; Charlotte-Concord-Gastonia,...</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc_counties</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 100 entries, 94 to 88823
Data columns (total 3 columns):
 #   Column       Non-Null Count  Dtype 
---  ------       --------------  ----- 
 0   region_id    100 non-null    object
 1   region_type  100 non-null    object
 2   region       100 non-null    object
dtypes: object(3)
memory usage: 3.1+ KB
</pre></div>
</div>
</div>
</div>
<p>There are 100 counties in NC, so this worked. Now, we can save these regions to a <strong>list</strong> and use that to pull data.</p>
<p>By exploring the data like this, you can maybe find the <em>region_id</em> values that you want and give them as a list. I’m also going to use the <code class="docutils literal notranslate"><span class="pre">qopts</span> <span class="pre">=</span> </code> option to name the columns that I want to pull. This isn’t necessary here, since I want all of the columns, but I wanted to show you that you could do this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc_county_list</span> <span class="o">=</span> <span class="n">nc_counties</span><span class="p">[</span><span class="s1">&#39;region_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zillow_nc</span> <span class="o">=</span> <span class="n">quandl</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s1">&#39;ZILLOW/DATA&#39;</span><span class="p">,</span> <span class="n">indicator_id</span> <span class="o">=</span> <span class="s1">&#39;ZATT&#39;</span><span class="p">,</span> <span class="n">paginate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">region_id</span> <span class="o">=</span> <span class="n">nc_county_list</span><span class="p">,</span>  <span class="n">qopts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;indicator_id&#39;</span><span class="p">,</span> <span class="s1">&#39;region_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zillow_nc</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>indicator_id</th>
      <th>region_id</th>
      <th>date</th>
      <th>value</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2023-03-31</td>
      <td>541442.450359</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2023-02-28</td>
      <td>542934.945251</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2023-01-31</td>
      <td>546725.963769</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-12-31</td>
      <td>539928.263825</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-11-30</td>
      <td>542585.370376</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-10-31</td>
      <td>598375.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-09-30</td>
      <td>601490.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-08-31</td>
      <td>606467.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-07-31</td>
      <td>607902.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-06-30</td>
      <td>608465.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-05-31</td>
      <td>597607.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-04-30</td>
      <td>585235.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-03-31</td>
      <td>572754.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-02-28</td>
      <td>556641.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2022-01-31</td>
      <td>538430.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-12-31</td>
      <td>516010.000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-11-30</td>
      <td>506505.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-10-31</td>
      <td>498382.000000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-09-30</td>
      <td>486909.000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-08-31</td>
      <td>475100.000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-07-31</td>
      <td>469689.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-06-30</td>
      <td>456018.000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-05-31</td>
      <td>443594.000000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-04-30</td>
      <td>435319.000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>ZATT</td>
      <td>999</td>
      <td>2021-03-31</td>
      <td>427213.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hey, there’s Durham County!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zillow_nc</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 26510 entries, 0 to 26509
Data columns (total 4 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   indicator_id  26510 non-null  object        
 1   region_id     26510 non-null  object        
 2   date          26510 non-null  datetime64[ns]
 3   value         26510 non-null  float64       
dtypes: datetime64[ns](1), float64(1), object(2)
memory usage: 828.6+ KB
</pre></div>
</div>
</div>
</div>
<p>Now you can filter by <em>date</em> if you like. And, you could pull down multiple states this way, change the variable type, etc. You could also merge in the region names using <em>region_id</em> as your key.</p>
</section>
<section id="using-rapid-api">
<h3><span class="section-number">7.3.2. </span>Using Rapid API<a class="headerlink" href="#using-rapid-api" title="Permalink to this headline">#</a></h3>
<p>Another data option is <a class="reference external" href="https://rapidapi.com/hub">Rapid API</a>. There’s all types of data here - markets, sports, gambling, housing, etc. People will write their own APIs, perhaps interfacing with the websites that contain the information. They can then publish their APIs on this webpage. Many have free options, some you have to pay for. There are thousands here, so you’ll have to dig around.</p>
<figure class="align-center" id="rapidapi-png">
<img alt="../_images/07-rapidapi.png" src="../_images/07-rapidapi.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.4 </span><span class="caption-text">Main Rapid API webpage</span><a class="headerlink" href="#rapidapi-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>One you have an account, you’ll be able to subscribe to different APIs. You probably want the data to have a free option.</p>
<p>The quick start guide is <a class="reference external" href="https://docs.rapidapi.com/docs/consumer-quick-start-guide">here</a>.</p>
<p>Luckily, all of the APIs here tend to have the same structures. These are called <strong>REST APIs</strong>. This stands for “Representational State Transfer” and is just a standardized way for computers to talk to each other. They are going to use a standard data format, like JSON. More on this below.</p>
<p>You can read more on their <a class="reference external" href="https://rapidapi.com/learn/rest">API Learn page</a>.</p>
<p>We’ll look at one example, Pinnacle Odds, which has some sports gambling information: <a class="reference external" href="https://rapidapi.com/tipsters/api/pinnacle-odds/">https://rapidapi.com/tipsters/api/pinnacle-odds/</a></p>
<p>Once you’ve subscribed, you see the main <strong>endpoint</strong> screen.</p>
<figure class="align-center" id="rapidapi-endpoint-png">
<img alt="../_images/07-rapidapi-endpoint.png" src="../_images/07-rapidapi-endpoint.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.5 </span><span class="caption-text">Pinnacle Odds endpoint page. I’ve blocked my API key with two different windows.</span><a class="headerlink" href="#rapidapi-endpoint-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>At the top, you’ll see Endpoints, About, Tutorials, Discussions, and Pricing. Click around to read more about the API.</p>
<p>We are currently on <strong>Endpoints</strong>. Endpoints are basically like URLs. They are where different tables of data live. We are going to use this page to figure out the data that we need. And, the webpage page will also create the Python code needed to download the data!</p>
<p>You can start on the left of the screen. You’ll see a list of the different tables available. I’ll try <strong>List of Sports</strong> in this example. You’ll see why in a minute.</p>
<p>You’ll note that the middle section now changed. This is where you can filter and ask for particular types of data from that table. In this case, there are no options to change.</p>
<p>On the right, you’ll see Code Snippets. The default is Node.js, a type of Javascript. We don’t want that. Click the dropdown box and look for Python. They have three ways, using three different packages, to interface with the API from Python and download the data. I’ll pick <code class="docutils literal notranslate"><span class="pre">Requests</span></code> - it seemed to work below.</p>
<p>This will change the code. You’ll see the package import, your API key, the host, and the data request. You can click <strong>Copy Code</strong>.</p>
<p>But, before we run this on our end, let’s click <strong>Test Endpoint</strong>. That’s the blue box in the middle. Then, click <strong>Results</strong> on the left and <strong>Body</strong>. By doing this, we essentially just ran that code in the browser. We can see what data we’re going to get. This is a <strong>JSON file</strong> with 9 items. Each item has 6 keys. You can see what the keys are - they are giving us the ids for each sport. For example, “Soccer” is “id = 1”.</p>
<p>This is very helpful! We need to know these id values if we want to pull particular sports.</p>
<p>For fun, let’s pull this simple JSON file on our end. I’ve copied and pasted the code below. It didn’t like the <code class="docutils literal notranslate"><span class="pre">print</span></code> function, so I just dropped it. I have also commented out all of the code so that it doesn’t run. Why? I deleted the API key, since I didn’t want that public. You’ll use your own.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; import requests</span>

<span class="sd">url = &quot;https://pinnacle-odds.p.rapidapi.com/kit/v1/sports&quot;</span>

<span class="sd">headers = {</span>
<span class="sd">	&quot;X-RapidAPI-Key&quot;: &quot;YOUR API KEY GOES HERE&quot;,</span>
<span class="sd">	&quot;X-RapidAPI-Host&quot;: &quot;pinnacle-odds.p.rapidapi.com&quot;</span>
<span class="sd">}</span>

<span class="sd">sports_ids = requests.request(&quot;GET&quot;, url, headers=headers)</span>

<span class="sd">print(sports_ids.text) &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; import requests\n\nurl = &quot;https://pinnacle-odds.p.rapidapi.com/kit/v1/sports&quot;\n\nheaders = {\n\t&quot;X-RapidAPI-Key&quot;: &quot;YOUR API KEY GOES HERE&quot;,\n\t&quot;X-RapidAPI-Host&quot;: &quot;pinnacle-odds.p.rapidapi.com&quot;\n}\n\nsports_ids = requests.request(&quot;GET&quot;, url, headers=headers)\n\nprint(sports_ids.text) &#39;
</pre></div>
</div>
</div>
</div>
<p>We can turn that response file into a JSON file. This is what it wants to be!</p>
<p>All of the code that follows is also commented out so that it doesn’t run every time I edit this online book. The output from the code is still there, however.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; sports_ids_json = sports_ids.json()</span>
<span class="sd">sports_ids_json &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; sports_ids_json = sports_ids.json()\nsports_ids_json &#39;
</pre></div>
</div>
</div>
</div>
<p>That’s JSON. I was able to show the whole thing in the notebook.</p>
<p>Let’s get that into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame now. To do that, we have to know a bit about how JSON files are structured. This one is easy. <code class="docutils literal notranslate"><span class="pre">pd.json_normalize</span></code> is a useful tool here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; sports_ids_df = pd.json_normalize(data = sports_ids_json)</span>
<span class="sd">sports_ids_df &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; sports_ids_df = pd.json_normalize(data = sports_ids_json)\nsports_ids_df &#39;
</pre></div>
</div>
</div>
</div>
<p>What do all of those columns mean? I don’t know! You’d want to read the documentation for your API.</p>
<p>Also, note how I’m changing the names of my objects as I go. I want to keep each data structure in memory - what I originally downloaded, the JSON file, the DataFrame. This way, I don’t overwrite anything and I won’t be forced to download the data all over again.</p>
<p>Now, let’s see if we can pull some actual data. I notice that <em>id = 3</em> is Basketball. Cool. Let’s try for some NBA data. Go back to the left of the <strong>Endpoint</strong> page and click on <strong>List of archive events</strong>. The middle will change and you’ll have some required and optional inputs. I know I want <em>sport_id</em> to be 3. But I don’t want all basketball. Just the NBA. So, I notice the <em>league_ids</em> option below. But I don’t know the number of the NBA.</p>
<p>OK, back to the left side. See <strong>List of leagues</strong>? Click that. I put in <em>sport_id = 3</em>. I then click <strong>Test Endpoint</strong>. I go to <strong>Results</strong>, select <strong>Body</strong>, and then <strong>Expand All</strong>. I do a CTRL-F to look for “NBA”.</p>
<p>And I find a bunch of possibilities! NBA games. Summer League. D-League. Summer League! If you’re betting on NBA Summer League, please seek help. Let’s use the regular NBA. That’s <em>league_id = 487</em>.</p>
<p>Back to <strong>List of archive events</strong>. I’ll add that league ID to the bottom of the middle. I set the page_num to 1000. I then click <strong>Test Endpoint</strong> and look at what I get.</p>
<p>Nothing! That’s an empty looking file on the right. Maybe this API doesn’t keep archived NBA? Who knows.</p>
<p>Let’s try another endpoint. Click on <strong>List of markets</strong>. Let’s see what this one has. In the middle, I’ll again use the codes for basketball and NBA. I’ll set <em>is_have_odds</em> to True. Let’s test the endpoint and see what we get.</p>
<figure class="align-center" id="rapidapi-nba-png">
<img alt="../_images/07-rapidapi-nba.png" src="../_images/07-rapidapi-nba.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.6 </span><span class="caption-text">Some NBA odds for this weekend.</span><a class="headerlink" href="#rapidapi-nba-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We can expand the result and look at the data structure. This is a more complicated one. I see 8 items under events. These correspond to the 8 games this weekend. Then, under each event, you can keep drilling down. The <em>level 0</em> is kind of like the header for that event. It has the game, the start time, the teams, etc. You’ll see 4 more keys under <em>periods</em>. Each of these is a different betting line, with money lines, spreads, what I think are over/under point totals, etc.</p>
<p>Anyway, the main thing here is that we have indeed pulled some rather complex looking data. That data is current for upcoming games, not historical. But, we can still pull this in and use it to see how to work with a more complex JSON structure.</p>
<p>I’ll copy and paste the code again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; import requests</span>

<span class="sd">url = &quot;https://pinnacle-odds.p.rapidapi.com/kit/v1/markets&quot;</span>

<span class="sd">querystring = {&quot;sport_id&quot;:&quot;3&quot;,&quot;league_ids&quot;:&quot;487&quot;,&quot;is_have_odds&quot;:&quot;true&quot;}</span>

<span class="sd">headers = {</span>
<span class="sd">	&quot;X-RapidAPI-Key&quot;: &quot;YOUR API KEY GOES HERE&quot;,</span>
<span class="sd">	&quot;X-RapidAPI-Host&quot;: &quot;pinnacle-odds.p.rapidapi.com&quot;</span>
<span class="sd">}</span>

<span class="sd">current = requests.request(&quot;GET&quot;, url, headers=headers, params=querystring)</span>

<span class="sd">print(current.text) &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; import requests\n\nurl = &quot;https://pinnacle-odds.p.rapidapi.com/kit/v1/markets&quot;\n\nquerystring = {&quot;sport_id&quot;:&quot;3&quot;,&quot;league_ids&quot;:&quot;487&quot;,&quot;is_have_odds&quot;:&quot;true&quot;}\n\nheaders = {\n\t&quot;X-RapidAPI-Key&quot;: &quot;YOUR API KEY GOES HERE&quot;,\n\t&quot;X-RapidAPI-Host&quot;: &quot;pinnacle-odds.p.rapidapi.com&quot;\n}\n\ncurrent = requests.request(&quot;GET&quot;, url, headers=headers, params=querystring)\n\nprint(current.text) &#39;
</pre></div>
</div>
</div>
</div>
<p>Does that query string above make sense now?</p>
<p>I’ll convert that data to JSON below and peak at it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; current_json = current.json()</span>
<span class="sd">current_json &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; current_json = current.json()\ncurrent_json &#39;
</pre></div>
</div>
</div>
</div>
<p>OK, now this is the tricky part. How do we get this thing into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame? This is where we really have to think carefully. What do we actually want? Remember, a DataFrame, at its simplest, looks like a spreadsheet, with rows and columns? How could this thing possibly look like that?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; current_df = pd.json_normalize(data = current_json)</span>
<span class="sd">current_df &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; current_df = pd.json_normalize(data = current_json)\ncurrent_df &#39;
</pre></div>
</div>
</div>
</div>
<p>We need to <strong>flatten</strong> this file. JSON files are nested. That’s what all those brackets are doing. Let’s think a little more about that.</p>
<figure class="align-center" id="json-png">
<img alt="../_images/07-json.png" src="../_images/07-json.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.7 </span><span class="caption-text">JSON structure. Source: https://towardsdatascience.com/all-pandas-json-normalize-you-should-know-for-flattening-json-13eae1dfb7dd</span><a class="headerlink" href="#json-png" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>JSON files are like dictionaries, as you can see in the picture above. There’s a key and a value. However, they can get complicated where there’s a list of dictionaries embedded in the same data structure. You can think of navigating them like working through the branches of a tree. Which branch do you want?</p>
<p>To do this, we’ll use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.json_normalize.html">pd.json_normalize</a> method. We’ve already just used it, but that was with a simple JSON file. It didn’t really work with the current odds data, unless we add more arguments.</p>
<p>You can read more <a class="reference external" href="https://towardsdatascience.com/all-pandas-json-normalize-you-should-know-for-flattening-json-13eae1dfb7dd">here</a>.</p>
<p>Everything is packed into that <em>events</em> column. Let’s flatten it. This will take every item in it and convert it into a new column. Keys will be combined together to create compound names that combine different levels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; current_df_events = pd.json_normalize(data = current_json, record_path=[&#39;events&#39;])</span>
<span class="sd">current_df_events &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot; current_df_events = pd.json_normalize(data = current_json, record_path=[&#39;events&#39;])\ncurrent_df_events &quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; list(current_df_events) &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; list(current_df_events) &#39;
</pre></div>
</div>
</div>
</div>
<p>That’s a lot of columns! Do you see what it did? When I flattened the file, it worked its way through the dictionary and key values. So, periods to num_0 to totals to the various over/under values, etc. It then combined those permutations to create new columns, where each value is separated by a period. Then value at the end of the chain is what goes into the DataFrame.</p>
<p>That’s a quick introduction to Rapid API and dealing with its JSON output. Every API is different - you’ll have to play around.</p>
</section>
<section id="data-on-kaggle">
<h3><span class="section-number">7.3.3. </span>Data on Kaggle<a class="headerlink" href="#data-on-kaggle" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://www.kaggle.com">Kaggle</a> is also a great source for data. You can search their <a class="reference external" href="https://www.kaggle.com/datasets">data sets here</a>.</p>
<p>Searching for finance, I see one on <a class="reference external" href="https://www.kaggle.com/datasets/kaggle/us-consumer-finance-complaints">consumer finance complaints</a> that looks interesting. The Kaggle page describes the data, gives you a data dictionary, and some examples.</p>
<p>The data for Kaggle contests is usually pretty clean already. That said, you’ll usually have to do at least some work to get it ready to look at.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="6_financial_ts.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">6. </span>Financial time series <a id='financial-time-series'></a></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="8_port_math.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Essential portfolio math</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Prof. Adam Aiken<br/>
  
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>